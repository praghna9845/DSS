<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Traffic Management — Prototype</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#03a87c; --muted:#9aa5b1; --danger:#ff6b6b; --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.02);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071021 0%, #071827 60%);color:#e6eef3}
    .app{display:grid;grid-template-columns:360px 1fr;gap:20px;padding:28px;min-height:100vh}

    /* SIDEBAR */
    .sidebar{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#2ad0b0);display:flex;align-items:center;justify-content:center;font-weight:700;color:#042;}
    h1{font-size:18px;margin:0}
    p.lead{color:var(--muted);margin-top:6px;font-size:13px}
    .controls{margin-top:18px;display:flex;flex-direction:column;gap:12px}
    .btn{background:var(--glass);border-radius:10px;padding:10px 12px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#00caae);color:#032;border:font-weight:600}
    .stat{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:10px;background:var(--glass-2);border:1px solid rgba(255,255,255,0.02)}
    .stat .k{font-size:20px;font-weight:700}
    .small{font-size:12px;color:var(--muted)}

    /* MAIN */
    .main{display:flex;flex-direction:column;gap:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:16px;}
    .grid2{display:grid;grid-template-columns:1fr 420px;gap:18px}

    /* Intersection visual */
    .intersection{position:relative;height:420px;background:linear-gradient(180deg,#082032 0%, #022 100%);border-radius:10px;display:flex;align-items:center;justify-content:center}
    .road{position:absolute;background:#0b0f13}
    .road.h{height:120px;width:80%;border-radius:8px}
    .road.v{width:120px;height:80%;border-radius:8px}
    .lane{position:absolute;background:linear-gradient(180deg,#1b2730,#0c1418);border-radius:4px;padding:6px;color:#cce3e8;font-size:13px}
    .signal{position:absolute;width:34px;height:46px;border-radius:6px;background:rgba(0,0,0,0.6);display:flex;flex-direction:column;gap:6px;align-items:center;padding:6px;border:1px solid rgba(255,255,255,0.03)}
    .signal .light{width:18px;height:18px;border-radius:50%;background:#192227;box-shadow:inset 0 -2px 6px rgba(0,0,0,0.5)}
    .signal .light.on.green{background:linear-gradient(#9ef0c9,#15a56e);box-shadow:0 0 12px rgba(36,200,140,0.18)}
    .signal .light.on.red{background:linear-gradient(#ffd1d1,#ff6b6b)}
    .signal .light.on.yellow{background:linear-gradient(#fff1b8,#ffcf4d)}
    /* positions */
    .signal.top{top:18%;left:50%;transform:translateX(-50%)}
    .signal.bottom{bottom:18%;left:50%;transform:translateX(-50%)}
    .signal.left{left:18%;top:50%;transform:translateY(-50%)}
    .signal.right{right:18%;top:50%;transform:translateY(-50%)}

    .legend{display:flex;gap:8px;align-items:center}
    .dot{width:10px;height:10px;border-radius:50%}

    /* table */
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:13px}

    footer{font-size:12px;color:var(--muted);text-align:center;margin-top:6px}

    /* responsive */
    @media (max-width:980px){.app{grid-template-columns:1fr;}.grid2{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar card">
      <div class="brand">
        <div class="logo">STM</div>
        <div>
          <h1>Smart Traffic Manager</h1>
          <p class="lead">Prototype — HTML / CSS / JS simulation</p>
        </div>
      </div>

      <div style="margin-top:14px;display:flex;flex-direction:column;gap:10px">
        <div class="stat">
          <div>
            <div class="small">Live vehicles (sim)</div>
            <div class="k" id="liveVehicles">0</div>
          </div>
          <div style="text-align:right">
            <div class="small">Avg wait</div>
            <div class="k" id="avgWait">0s</div>
          </div>
        </div>
        <div class="stat">
          <div>
            <div class="small">Congestion level</div>
            <div class="k" id="congestion">0%</div>
          </div>
          <div style="text-align:right">
            <div class="small">Throughput</div>
            <div class="k" id="throughput">0 v/min</div>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="btn primary" id="startBtn">Start Simulation</button>
        <button class="btn" id="stopBtn">Stop</button>

        <div style="display:flex;gap:8px">
          <label class="btn" style="flex:1">Sensor mode
            <select id="mode" style="margin-left:8px;background:transparent;border:0;color:inherit;outline:none">
              <option value="sim">Simulated</option>
              <option value="camera">Camera (placeholder)</option>
              <option value="sensor">Inductive loop (placeholder)</option>
            </select>
          </label>
        </div>

        <div style="margin-top:6px">
          <div class="small">Traffic scenario</div>
          <select id="scenario" class="btn">
            <option value="balanced">Balanced (all directions)</option>
            <option value="northHeavy">North-heavy</option>
            <option value="eastHeavy">East-heavy</option>
            <option value="rushHour">Rush hour spike</option>
          </select>
        </div>

        <div style="margin-top:12px">
          <div class="small">Signal strategy</div>
          <select id="strategy" class="btn">
            <option value="fixed">Fixed time</option>
            <option value="adaptive">Adaptive (vehicle density)</option>
            <option value="greenWave">Green wave (coordinated)</option>
          </select>
        </div>

      </div>

      <div style="margin-top:16px;display:flex;flex-direction:column;gap:8px">
        <div class="small">Recent events</div>
        <table>
          <thead><tr><th>Time</th><th>Event</th></tr></thead>
          <tbody id="eventsLog">
          </tbody>
        </table>
      </div>

      <footer>Prototype — no external data. Use to demo logic & UI ideas.</footer>
    </aside>

    <main class="main">
      <div class="grid2">
        <section class="card">
          <h3 style="margin:0 0 12px 0">Intersection — live view</h3>
          <div class="intersection" id="intersection">
            <!-- horizontal & vertical roads -->
            <div class="road h"></div>
            <div class="road v"></div>
            

            <!-- traffic signals -->
            <div class="signal top" id="sigNorth">
              <div class="light on red" id="sigN_red"></div>
              <div class="light" id="sigN_yellow"></div>
              <div class="light" id="sigN_green"></div>
            </div>
            <div class="signal bottom" id="sigSouth">
              <div class="light on red" id="sigS_red"></div>
              <div class="light" id="sigS_yellow"></div>
              <div class="light" id="sigS_green"></div>
            </div>
            <div class="signal left" id="sigWest">
              <div class="light on green" id="sigW_red"></div>
              <div class="light" id="sigW_yellow"></div>
              <div class="light on green" id="sigW_green"></div>
            </div>
            <div class="signal right" id="sigEast">
              <div class="light" id="sigE_red"></div>
              <div class="light" id="sigE_yellow"></div>
              <div class="light on green" id="sigE_green"></div>
            </div>

            <!-- lane indicators -->
            <div class="lane" style="top:18%;left:52%;transform:translateX(-50%);">N → S<br><span class="small" id="countN">0 vehicles</span></div>
            <div class="lane" style="bottom:18%;left:52%;transform:translateX(-50%);">S → N<br><span class="small" id="countS">0 vehicles</span></div>
            <div class="lane" style="left:18%;top:52%;transform:translateY(-50%);">W → E<br><span class="small" id="countW">0 vehicles</span></div>
            <div class="lane" style="right:18%;top:52%;transform:translateY(-50%);">E → W<br><span class="small" id="countE">0 vehicles</span></div>
          </div>
        </section>

        <aside class="card">
          <h3 style="margin:0 0 12px 0">Analytics & Metrics</h3>
          <canvas id="chart" width="380" height="180" style="background:transparent;border-radius:8px"></canvas>

          <h4 style="margin:12px 0 6px 0">Queue details</h4>
          <table>
            <thead><tr><th>Direction</th><th>Queue (vehicles)</th><th>Avg wait (s)</th></tr></thead>
            <tbody>
              <tr><td>North</td><td id="qN">0</td><td id="wN">0</td></tr>
              <tr><td>South</td><td id="qS">0</td><td id="wS">0</td></tr>
              <tr><td>West</td><td id="qW">0</td><td id="wW">0</td></tr>
              <tr><td>East</td><td id="qE">0</td><td id="wE">0</td></tr>
            </tbody>
          </table>

        </aside>
      </div>

      <section class="card">
        <h3 style="margin:0 0 12px 0">System log (events)</h3>
        <div style="height:120px;overflow:auto;background:var(--glass);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)" id="sysLog"></div>
      </section>

    </main>
  </div>

  <script>
    // Basic simulation for traffic intersection with adaptive/fixed strategies
    const state = {
      running: false,
      scenario:'balanced',
      strategy:'adaptive',
      counts:{N:0,S:0,E:0,W:0},
      waits:{N:0,S:0,E:0,W:0},
      throughput:0,
      events:[]
    };

    // helper: random arrival generation based on scenario
    function generateArrivals(){
      const s = document.getElementById('scenario').value;
      let base = 0.2; // avg vehicles per tick per direction
      const heavy = 0.6;
      if(s==='balanced'){
        return {N:rand(base),S:rand(base),E:rand(base),W:rand(base)};
      }else if(s==='northHeavy'){
        return {N:rand(heavy),S:rand(base*0.6),E:rand(base*0.5),W:rand(base*0.5)};
      }else if(s==='eastHeavy'){
        return {N:rand(base*0.5),S:rand(base*0.6),E:rand(heavy),W:rand(base*0.5)};
      }else if(s==='rushHour'){
        return {N:rand(1.2),S:rand(1.1),E:rand(1.3),W:rand(1.0)};
      }
      return {N:rand(base),S:rand(base),E:rand(base),W:rand(base)};
    }
    function rand(mean){ return Math.max(0,Math.round(randomNormal(mean,0.6))); }

    // normal approx using Box-Muller
    function randomNormal(mean,sd){
      let u=0,v=0;while(u===0)u=Math.random();while(v===0)v=Math.random();
      const num = Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v);
      return mean + sd * num;
    }

    // update UI counters
    function refreshUI(){
      const total = state.counts.N + state.counts.S + state.counts.E + state.counts.W;
      document.getElementById('liveVehicles').textContent = total;
      const avgWait = Math.round(((state.waits.N+state.waits.S+state.waits.E+state.waits.W)/4) || 0);
      document.getElementById('avgWait').textContent = avgWait + 's';
      const congestion = Math.min(100, Math.round((total/40) * 100));
      document.getElementById('congestion').textContent = congestion + '%';
      document.getElementById('throughput').textContent = state.throughput + ' v/min';
      document.getElementById('countN').textContent = state.counts.N + ' vehicles';
      document.getElementById('countS').textContent = state.counts.S + ' vehicles';
      document.getElementById('countW').textContent = state.counts.W + ' vehicles';
      document.getElementById('countE').textContent = state.counts.E + ' vehicles';

      // queue table
      document.getElementById('qN').textContent = state.counts.N;
      document.getElementById('qS').textContent = state.counts.S;
      document.getElementById('qW').textContent = state.counts.W;
      document.getElementById('qE').textContent = state.counts.E;
      document.getElementById('wN').textContent = state.waits.N;
      document.getElementById('wS').textContent = state.waits.S;
      document.getElementById('wW').textContent = state.waits.W;
      document.getElementById('wE').textContent = state.waits.E;

      // chart update
      drawChart();

      // system log
      const sys = document.getElementById('sysLog');
      sys.scrollTop = sys.scrollHeight;
    }

    // small event logger
    function logEvent(msg){
      const t = new Date().toLocaleTimeString();
      const row = `<tr><td>${t}</td><td>${msg}</td></tr>`;
      const ev = document.getElementById('eventsLog');
      ev.insertAdjacentHTML('afterbegin', row);
      const sys = document.getElementById('sysLog');
      sys.insertAdjacentHTML('beforeend','<div>['+t+'] '+msg+'</div>');
    }

    // simple signal state machine
    let cycleTimer = 0;
    let currentPhase = 0; // 0: N-S green, 1: E-W green, 2: all-red-yellow transitions
    let simInterval = null;

    function startSimulation(){
      if(state.running) return;
      state.running = true; state.throughput = 0; cycleTimer=0; currentPhase=0;
      document.getElementById('startBtn').textContent='Running...';
      logEvent('Simulation started');
      simInterval = setInterval(tick, 1000); // 1 second tick
    }
    function stopSimulation(){
      state.running = false; clearInterval(simInterval); simInterval=null;
      document.getElementById('startBtn').textContent='Start Simulation';
      logEvent('Simulation stopped');
    }

    // tick: arrivals, signalling, serving vehicles
    function tick(){
      cycleTimer++;
      const arrivals = generateArrivals();
      // add arrivals to queues
      for(const d of ['N','S','E','W']){
        state.counts[d] += arrivals[d];
        // increase waits conservatively
        state.waits[d] = Math.min(999, state.waits[d] + (state.counts[d]>0?1:0));
      }

      // decide signal durations
      const strategy = document.getElementById('strategy').value;
      let greenTimeNS=10, greenTimeEW=10;
      if(strategy==='fixed'){
        greenTimeNS=12; greenTimeEW=12;
      }else if(strategy==='greenWave'){
        greenTimeNS=8; greenTimeEW=8; // shorter, but coordinated (not simulated heavily here)
      }else if(strategy==='adaptive'){
        // adaptive: allocate green proportional to queue lengths (min 6s)
        const ns = state.counts.N + state.counts.S + 0.001;
        const ew = state.counts.E + state.counts.W + 0.001;
        const total = ns+ew;
        greenTimeNS = Math.max(6, Math.round((ns/total)*24));
        greenTimeEW = Math.max(6, Math.round((ew/total)*24));
      }

      // phase progression: alternate NS and EW
      // reset cycle if exceeded combined time
      const cycleLen = greenTimeNS + greenTimeEW + 4; // 2 sec all-red between
      const tmod = cycleTimer % cycleLen;
      if(tmod < greenTimeNS){ currentPhase = 0; }
      else if(tmod < greenTimeNS + 2){ currentPhase = 2; } // intergreen
      else if(tmod < greenTimeNS + 2 + greenTimeEW){ currentPhase = 1; }
      else { currentPhase = 2; }

      // serve vehicles depending on phase
      if(currentPhase===0){ // NS green
        // let up to X vehicles pass per second from N and S
        const servedN = Math.min(state.counts.N, Math.round( Math.max(1, state.counts.N>5?2:1) ));
        const servedS = Math.min(state.counts.S, Math.round( Math.max(1, state.counts.S>5?2:1) ));
        state.counts.N -= servedN; state.counts.S -= servedS;
        state.waits.N = Math.max(0, state.waits.N - servedN);
        state.waits.S = Math.max(0, state.waits.S - servedS);
        state.throughput = state.throughput + servedN + servedS;
      }else if(currentPhase===1){ // EW green
        const servedE = Math.min(state.counts.E, Math.round( Math.max(1, state.counts.E>5?2:1) ));
        const servedW = Math.min(state.counts.W, Math.round( Math.max(1, state.counts.W>5?2:1) ));
        state.counts.E -= servedE; state.counts.W -= servedW;
        state.waits.E = Math.max(0, state.waits.E - servedE);
        state.waits.W = Math.max(0, state.waits.W - servedW);
        state.throughput = state.throughput + servedE + servedW;
      } else {
        // intergreen: no one passes
      }

      // decay throughput to per-minute estimate (approx)
      if(state.throughput>60) state.throughput = Math.round(state.throughput*0.9);

      // update lights UI
      updateLights(currentPhase);

      // record occasional event
      if(Math.random()<0.08){ logEvent('Spike detected in arrivals'); }

      refreshUI();
    }

    function updateLights(phase){
      // clear all
      const sets = ['N','S','E','W'];
      for(const d of sets){
        document.getElementById('sig'+d+'_red')?.classList.remove('on','green','yellow');
        document.getElementById('sig'+d+'_yellow')?.classList.remove('on');
        document.getElementById('sig'+d+'_green')?.classList.remove('on');
      }
      if(phase===0){ // NS green
        document.getElementById('sigN_green').classList.add('on','green');
        document.getElementById('sigS_green').classList.add('on','green');
        document.getElementById('sigE_red').classList.add('on','red');
        document.getElementById('sigW_red').classList.add('on','red');
      }else if(phase===1){ // EW green
        document.getElementById('sigE_green').classList.add('on','green');
        document.getElementById('sigW_green').classList.add('on','green');
        document.getElementById('sigN_red').classList.add('on','red');
        document.getElementById('sigS_red').classList.add('on','red');
      }else{ // intergreen: yellow
        document.getElementById('sigN_yellow').classList.add('on','yellow');
        document.getElementById('sigS_yellow').classList.add('on','yellow');
        document.getElementById('sigE_yellow').classList.add('on','yellow');
        document.getElementById('sigW_yellow').classList.add('on','yellow');
      }
    }

    // simple chart: show queue lengths as bars
    const canvas = document.getElementById('chart');
    const ctx = canvas.getContext('2d');
    function drawChart(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      const labels = ['N','S','W','E'];
      const vals = [state.counts.N,state.counts.S,state.counts.W,state.counts.E];
      const maxv = Math.max(8,...vals,1);
      const w = 72; const gap=18; let x=20;
      ctx.font = '12px Inter, Arial';
      for(let i=0;i<labels.length;i++){
        const h = Math.round((vals[i]/maxv)*(canvas.height-40));
        ctx.fillStyle = 'rgba(255,255,255,0.08)';
        ctx.fillRect(x, canvas.height-30-h, w, h);
        ctx.fillStyle = '#e6eef3';
        ctx.fillText(labels[i], x + w/2 - 6, canvas.height-8);
        ctx.fillText(vals[i], x + 8, canvas.height-34-h);
        x += w + gap;
      }
      // small legend
      ctx.fillStyle = 'rgba(255,255,255,0.04)';
      ctx.fillRect(canvas.width-120, 12, 100, 32);
      ctx.fillStyle = '#cbd6dc'; ctx.fillText('Queues (vehicles)', canvas.width-108, 32);
    }

    // UI wiring
    document.getElementById('startBtn').addEventListener('click', ()=>{
      if(state.running) return; startSimulation();
    });
    document.getElementById('stopBtn').addEventListener('click', ()=> stopSimulation());
    document.getElementById('scenario').addEventListener('change', (e)=>{ state.scenario=e.target.value; logEvent('Scenario set: '+e.target.value); });
    document.getElementById('strategy').addEventListener('change', (e)=>{ state.strategy=e.target.value; logEvent('Strategy set: '+e.target.value); });

    // initial draw
    drawChart();
    logEvent('Prototype loaded');

    // small demo: pre-fill some vehicles
    state.counts.N=3; state.counts.E=1; state.counts.S=2; state.counts.W=1;
    refreshUI();
  </script>
  

</body>
</html>