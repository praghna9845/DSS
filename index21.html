<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Traffic Simulation Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #f4f7fb;
    color: #111;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    margin: 15px;
    color: #0078d7;
    text-shadow: 0 0 6px #0078d744;
  }
  #main {
    display: flex;
    gap: 30px;
    align-items: flex-start;
    justify-content: center;
  }
  #controls {
    margin-bottom: 15px;
  }
  button {
    padding: 10px 20px;
    background: #0078d7;
    border: none;
    color: white;
    border-radius: 8px;
    margin: 0 5px;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover { background: #005fa3; }
  
  /* Dashboard Styling */
  #dashboard {
    display: flex;
    gap: 15px;
    margin: 10px;
    text-align: center;
  }
  .card {
    background: #ffffff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 12px 20px;
    border-radius: 12px;
    min-width: 140px;
    color: #333;
  }
  .card span {
    font-size: 1.6em;
    font-weight: bold;
    color: #0078d7;
  }

  /* Intersection Simulation */
  #intersection {
    position: relative;
    width: 420px;
    height: 420px;
    background: #e9edf5;
    border: 4px solid #0078d7;
    border-radius: 10px;
  }
  .road {
    position: absolute;
    background: #b0bec5;
  }
  .vertical {
    width: 80px;
    height: 100%;
    left: 50%;
    transform: translateX(-50%);
  }
  .horizontal {
    width: 100%;
    height: 80px;
    top: 50%;
    transform: translateY(-50%);
  }
  .signal {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .light {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    margin: 3px;
    background: #ccc;
  }
  .on.red { background: #ff4b5c; box-shadow: 0 0 8px #ff4b5c; }
  .on.green { background: #00c896; box-shadow: 0 0 8px #00c896; }
  .signal.top { top: 10px; left: 50%; transform: translateX(-50%); }
  .signal.bottom { bottom: 10px; left: 50%; transform: translateX(-50%) rotate(180deg); }
  .signal.left { left: 10px; top: 50%; transform: translateY(-50%) rotate(90deg); }
  .signal.right { right: 10px; top: 50%; transform: translateY(-50%) rotate(-90deg); }

  .car {
    position: absolute;
    width: 24px;
    height: 36px;
    border-radius: 5px;
    background: #0078d7;
    text-align: center;
    font-size: 11px;
    line-height: 36px;
    font-weight: bold;
    color: #fff;
  }

  /* Chart Area */
  #chart-area {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 15px;
  }
  canvas {
    background: #ffffff;
    border-radius: 10px;
  }
</style>
</head>
<body>

<h1>ðŸš¦ Smart Traffic Management Simulation</h1>

<div id="controls">
  <button id="startBtn">Start Simulation</button>
  <button id="stopBtn">Stop</button>
</div>

<div id="dashboard">
  <div class="card">Live Vehicles<br><span id="liveVehicles">0</span></div>
  <div class="card">Congestion<br><span id="congestion">0%</span></div>
  <div class="card">Throughput<br><span id="throughput">0</span></div>
</div>

<div id="main">
  <div id="intersection">
    <div class="road vertical"></div>
    <div class="road horizontal"></div>

    <div class="signal top"><div class="light red"></div><div class="light green"></div></div>
    <div class="signal bottom"><div class="light red"></div><div class="light green"></div></div>
    <div class="signal left"><div class="light red"></div><div class="light green"></div></div>
    <div class="signal right"><div class="light red"></div><div class="light green"></div></div>
  </div>

  <div id="chart-area">
    <canvas id="trafficChart" width="420" height="300"></canvas>
  </div>
</div>

<script>
const lights = {
  north: document.querySelector('.signal.top'),
  south: document.querySelector('.signal.bottom'),
  west: document.querySelector('.signal.left'),
  east: document.querySelector('.signal.right')
};
const live = document.getElementById('liveVehicles');
const cong = document.getElementById('congestion');
const throughput = document.getElementById('throughput');

let interval = null, tick = 0, activeDir = 'north';
let cars = [];
const dirs = ['north', 'south', 'west', 'east'];

const ctx = document.getElementById('trafficChart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [
      { label: 'Congestion (%)', data: [], borderColor: '#0078d7', tension: 0.3 },
      { label: 'Throughput (cars/min)', data: [], borderColor: '#00c896', tension: 0.3 }
    ]
  },
  options: {
    plugins: { legend: { labels: { color: '#333' } } },
    scales: {
      x: { ticks: { color: '#666' }, grid: { color: '#ddd' } },
      y: { ticks: { color: '#666' }, grid: { color: '#eee' }, beginAtZero: true }
    }
  }
});

function updateLights(dir) {
  Object.values(lights).forEach(sig => {
    sig.querySelectorAll('.light').forEach(l => l.classList.remove('on'));
    sig.querySelector('.light.red').classList.add('on', 'red');
  });
  const sig = lights[dir];
  sig.querySelector('.light.red').classList.remove('on');
  sig.querySelector('.light.green').classList.add('on', 'green');
}

function createCar(direction, id) {
  const car = document.createElement('div');
  car.classList.add('car');
  car.dataset.dir = direction;
  car.textContent = id;
  switch (direction) {
    case 'north': car.style.top = '0%'; car.style.left = '48%'; break;
    case 'south': car.style.top = '90%'; car.style.left = '52%'; break;
    case 'west':  car.style.top = '48%'; car.style.left = '0%'; break;
    case 'east':  car.style.top = '52%'; car.style.left = '90%'; break;
  }
  document.getElementById('intersection').appendChild(car);
  cars.push(car);
}

function moveCars() {
  cars.forEach((car, i) => {
    const dir = car.dataset.dir;
    let top = parseFloat(car.style.top);
    let left = parseFloat(car.style.left);

    if (dir === 'north' && activeDir === 'north') top += 2;
    if (dir === 'south' && activeDir === 'south') top -= 2;
    if (dir === 'west'  && activeDir === 'west')  left += 2;
    if (dir === 'east'  && activeDir === 'east')  left -= 2;

    car.style.top = top + '%';
    car.style.left = left + '%';

    if (top > 100 || top < 0 || left > 100 || left < 0) {
      car.remove();
      cars.splice(i, 1);
    }
  });
}

function updateDashboard() {
  const total = cars.length;
  const congestionLevel = Math.min(100, total * 5);
  const throughputVal = Math.floor(Math.random() * 10) + 5;

  live.textContent = total;
  cong.textContent = congestionLevel + '%';
  throughput.textContent = throughputVal;

  chart.data.labels.push('');
  chart.data.datasets[0].data.push(congestionLevel);
  chart.data.datasets[1].data.push(throughputVal);
  if (chart.data.labels.length > 20) {
    chart.data.labels.shift();
    chart.data.datasets[0].data.shift();
    chart.data.datasets[1].data.shift();
  }
  chart.update();
}

let idCounter = 1;
function simulateStep() {
  tick++;
  if (Math.random() < 0.7) createCar(dirs[Math.floor(Math.random() * 4)], idCounter++);

  moveCars();
  updateDashboard();

  if (tick % 8 === 0) {
    activeDir = dirs[(dirs.indexOf(activeDir) + 1) % 4];
    updateLights(activeDir);
  }
}

document.getElementById('startBtn').addEventListener('click', () => {
  if (interval) return;
  updateLights(activeDir);
  interval = setInterval(simulateStep, 300);
});
document.getElementById('stopBtn').addEventListener('click', () => {
  clearInterval(interval);
  interval = null;
});
</script>
</body>
</html>
